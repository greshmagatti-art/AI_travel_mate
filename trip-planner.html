<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>AI Travel Mate - Plan Your Trip</title>
    <style>
        /* (same styles as your original file) */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.25) 0%, rgba(118, 75, 162, 0.25) 100%), url('backend.jpg');
            background-size: cover; background-position: center center; background-attachment: fixed; background-repeat: no-repeat;
            min-height: 100vh; color: #333;
        }
        .header { display:flex; justify-content:space-between; align-items:center; width:100%; height:80px; background-color:rgba(255,255,255,0.95);
            backdrop-filter: blur(10px); position: relative; padding: 0 20px; box-shadow: 0 2px 20px rgba(0,0,0,0.1); z-index:100; }
        .left-section { display:flex; align-items:center; gap:20px; }
        .appimg { width:55px; height:55px; border-radius:12px; display:flex; align-items:center; justify-content:center; box-shadow:0 4px 15px rgba(102,126,234,0.3); overflow:hidden; }
        .logo-img { width:100%; height:100%; object-fit:cover; border-radius:12px; }
        .appname { font-size:24px; font-weight:700; color:#2d3748; }
        .back-home { background: rgba(255,255,255,0.9); border:2px solid #e2e8f0; color:#667eea; padding:10px 20px; border-radius:25px; cursor:pointer; font-weight:500; transition:all .3s ease; text-decoration:none; font-size:14px; }
        .back-home:hover { background:white; border-color:#667eea; transform:translateY(-2px); box-shadow: 0 4px 15px rgba(102,126,234,0.2); }

        .container { max-width:1200px; margin:0 auto; padding:40px 20px; }
        .page-title { text-align:center; margin-bottom:40px; color:white; }
        .page-title h1 { font-size:3rem; font-weight:800; margin-bottom:10px; text-shadow:0 4px 20px rgba(0,0,0,0.3); }
        .page-title p { font-size:1.2rem; opacity:0.9; }

        .trip-form { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border-radius:16px; padding:40px; box-shadow:0 10px 30px rgba(0,0,0,0.1); margin-bottom:30px; }
        .form-row { display:grid; grid-template-columns: 1fr 1fr 1fr; gap:20px; margin-bottom:30px; }
        .form-group { display:flex; flex-direction:column; }
        .form-group label { font-size:14px; font-weight:600; color:#2d3748; margin-bottom:8px; }
        .form-group input, .form-group select { padding:14px 16px; border:2px solid #e2e8f0; border-radius:8px; font-size:16px; transition:all .3s ease; background:white; }
        .form-group input:focus, .form-group select:focus { outline:none; border-color:#667eea; box-shadow: 0 0 0 3px rgba(102,126,234,0.1); }
        .generate-btn { width:100%; padding:16px; background: linear-gradient(135deg, #f093fb 0%, #e0364d 100%); color:white; border:none; border-radius:12px; font-size:16px; font-weight:600; cursor:pointer; transition:all .3s; text-transform:uppercase; letter-spacing:1px; box-shadow:0 8px 25px rgba(245,87,108,0.4); }
        .generate-btn:hover { transform:translateY(-3px); box-shadow:0 12px 35px rgba(245,87,108,0.5); }
        .generate-btn:disabled { opacity:0.6; cursor:not-allowed; transform:none; }

        .route-container { display:grid; grid-template-columns:1fr 2fr; gap:20px; margin-bottom:30px; }
        .routes-panel { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border-radius:16px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,0.1); min-height:500px; }
        .routes-panel h3 { color:#2d3748; margin-bottom:20px; font-size:1.5rem; text-align:center; }
        .routes-list { display:flex; flex-direction:column; gap:15px; }
        .route-item { background: rgba(102,126,234,0.1); border:2px solid rgba(102,126,234,0.2); border-radius:12px; padding:15px; cursor:pointer; transition:all .3s; }
        .route-item:hover { background: rgba(102,126,234,0.2); border-color:#667eea; transform: translateY(-2px); }
        .route-item.active { background: rgba(102,126,234,0.2); border-color:#667eea; box-shadow:0 4px 15px rgba(102,126,234,0.3); }

        .route-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
        .route-title { font-weight:600; color:#2d3748; font-size:1.1rem; }
        .route-badge { background:#667eea; color:white; padding:4px 8px; border-radius:6px; font-size:.8rem; font-weight:500; }

        .route-details { display:grid; grid-template-columns:1fr 1fr; gap:10px; font-size:.9rem; color:#4a5568; }
        .route-detail { display:flex; align-items:center; gap:5px; }
        .route-placeholder { text-align:center; color:#718096; padding:40px 20px; }

        .map-container { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border-radius:16px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,0.1); min-height:500px; display:flex; align-items:center; justify-content:center; flex-direction:column; }
        #map { width:100%; height:460px; border-radius:12px; display:none; }
        #map.active { display:block; }

        .map-placeholder { text-align:center; color:#718096; }
        .map-placeholder h3 { font-size:1.5rem; margin-bottom:10px; color:#2d3748; }
        .map-placeholder p { font-size:1rem; margin-bottom:20px; }

        .map-content { width:100%; height:400px; border-radius:12px; overflow:hidden; display:none; }
        .map-content.active { display:block; }

        .trip-details, .nearby-places { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border-radius:16px; padding:30px; box-shadow:0 10px 30px rgba(0,0,0,0.1); margin-top:20px; display:none; }
        .trip-details.active, .nearby-places.active { display:block; }

        .details-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:20px; }
        .detail-item { text-align:center; padding:20px; background: rgba(102,126,234,0.1); border-radius:12px; }
        .detail-item h4 { font-size:1.2rem; color:#2d3748; margin-bottom:8px; }
        .detail-item p { font-size:1.5rem; font-weight:700; color:#667eea; }

        .places-container { display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:20px; }
        .place-category { background: rgba(102,126,234,0.05); border-radius:12px; padding:20px; border:1px solid rgba(102,126,234,0.1); }
        .category-header { display:flex; align-items:center; gap:10px; margin-bottom:15px; padding-bottom:10px; border-bottom:2px solid rgba(102,126,234,0.1); }
        .category-icon { font-size:1.5rem; }
        .category-header h4 { color:#2d3748; font-size:1.2rem; font-weight:600; margin:0; }
        .places-list { display:flex; flex-direction:column; gap:12px; }
        .place-item { background:white; border-radius:8px; padding:12px; border:1px solid #e2e8f0; transition:all .3s; cursor:pointer; }
        .place-item:hover { border-color:#667eea; box-shadow:0 2px 8px rgba(102,126,234,0.1); transform: translateY(-1px); }
        .place-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
        .place-name { font-weight:600; color:#2d3748; font-size:.95rem; }
        .place-link { color:#667eea; font-size:.8rem; text-decoration:none; }
        .place-details { display:flex; flex-direction:column; gap:4px; }
        .place-detail { display:flex; align-items:center; gap:6px; font-size:.85rem; color:#4a5568; }
        .rating { color:#f6ad55; } .distance { color:#667eea; } .price { color:#38a169; font-weight:500; }

        @media (max-width:768px) {
            .form-row { grid-template-columns:1fr; gap:15px; }
            .page-title h1 { font-size:2rem; }
            .trip-form { padding:20px; }
            .container { padding:20px 10px; }
            .route-container { grid-template-columns:1fr; gap:15px; }
            .routes-panel { min-height:auto; }
            .map-container { min-height:400px; }
            #map { height:350px; }
        }

        /* Chat widget (kept from original) */
        .chat-widget { position: fixed; right: 20px; bottom: 20px; z-index: 1000; }
        .chat-toggle-btn { width:56px; height:56px; border-radius:50%; border: none; background: linear-gradient(135deg, #667eea, #764ba2); color:#fff; font-size:24px; box-shadow:0 10px 25px rgba(102,126,234,0.4); cursor:pointer; }
        .chat-panel { position: fixed; right: 20px; bottom: 90px; width: 320px; max-width: calc(100vw - 40px); height: 440px; background:#ffffff; border-radius:16px; box-shadow:0 20px 40px rgba(0,0,0,0.2); display:flex; flex-direction:column; overflow:hidden; transform:translateX(360px); transition: transform .3s ease; }
        .chat-panel.open { transform: translateX(0); }
        .chat-header { background: linear-gradient(135deg, #667eea, #764ba2); color:#fff; padding:12px 16px; display:flex; align-items:center; justify-content:space-between; font-weight:600; }
        .chat-messages { flex:1; padding:12px; background:#f7f9fc; overflow-y:auto; }
        .msg { max-width:85%; padding:10px 12px; border-radius:12px; margin:8px 0; font-size:14px; line-height:1.4; }
        .msg.bot { background:#eef2ff; color:#2d3748; } .msg.user { background:#e6fffa; color:#234e52; margin-left:auto; }
        .chat-input { display:flex; gap:8px; padding:10px; border-top:1px solid #edf2f7; background:#fff; }
        .chat-input input { flex:1; padding:10px 12px; border:2px solid #e2e8f0; border-radius:10px; font-size:14px; }
        .chat-input button { padding:10px 14px; border:none; background:#667eea; color:#fff; border-radius:10px; cursor:pointer; }

    </style>
</head>
<body>
    <div class="header">
        <div class="left-section">
            <div class="appimg">
                <img src="logo.jpg" alt="AI Travel Mate Logo" class="logo-img">
            </div>
            <div class="appname">AI Travel Mate</div>
        </div>
        <a href="trippage.html" class="back-home">‚Üê Back to Home</a>
    </div>

    <div class="container">
        <div class="page-title">
            <h1>Plan Your Perfect Trip</h1>
            <p>Enter your travel details and let AI generate the perfect route for you</p>
        </div>

        <div class="trip-form">
            <form id="tripForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="source">Source / Start Point</label>
                        <input type="text" id="source" name="source" placeholder="Enter your starting location" required>
                    </div>
                    <div class="form-group">
                        <label for="destination">Destination</label>
                        <input type="text" id="destination" name="destination" placeholder="Where do you want to go?" required>
                    </div>
                    <div class="form-group">
                        <label for="mode">Transportation Mode</label>
                        <select id="mode" name="mode" required>
                            <option value="">Select mode</option>
                            <option value="driving">üöó Driving</option>
                            <option value="walking">üö∂ Walking</option>
                            <option value="bicycling">üö¥ Bicycling</option>
                            <option value="transit">üöå Public Transit</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="generate-btn" id="generateBtn">Generate Route</button>
            </form>
        </div>

        <div class="route-container">
            <div class="routes-panel" id="routesPanel">
                <h3>Best Routes</h3>
                <div class="routes-list" id="routesList">
                    <div class="route-placeholder">
                        <p>Fill in the form and click "Generate Route" to see the best routes</p>
                    </div>
                </div>
            </div>
            <div class="map-container">
                <div class="map-placeholder" id="mapPlaceholder">
                    <div class="map-icon">üó∫Ô∏è</div>
                    <h3>Your Route Will Appear Here</h3>
                    <p>Fill in the form above and click "Generate Route" to see your personalized travel map</p>
                </div>
                <div class="map-content" id="mapContent">
                    <div id="map"></div>
                </div>
            </div>
        </div>

        <div class="trip-details" id="tripDetails">
            <h3 style="text-align: center; margin-bottom: 20px; color: #2d3748;">Trip Information</h3>
            <div class="details-grid" id="detailsGrid"></div>
        </div>

        <div class="nearby-places" id="nearbyPlaces">
            <h3 style="text-align: center; margin-bottom: 20px; color: #2d3748;">Nearby Places</h3>
            <div class="places-container">
                <div class="place-category">
                    <div class="category-header">
                        <span class="category-icon">üçΩÔ∏è</span>
                        <h4>Restaurants</h4>
                    </div>
                    <div class="places-list" id="restaurantsList"></div>
                </div>

                <div class="place-category">
                    <div class="category-header">
                        <span class="category-icon">üè•</span>
                        <h4>Hospitals</h4>
                    </div>
                    <div class="places-list" id="hospitalsList"></div>
                </div>

                <div class="place-category">
                    <div class="category-header">
                        <span class="category-icon">‚õΩ</span>
                        <h4>Gas Stations</h4>
                    </div>
                    <div class="places-list" id="gasStationsList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Chatbot -->
    <div class="chat-widget" aria-live="polite">
        <div class="chat-panel" id="chatPanel" role="dialog" aria-label="Travel Assistant Chat" aria-modal="false">
            <div class="chat-header">
                <span>Travel Assistant</span>
                <button id="closeChat" title="Close" style="background: transparent; border: 0; color: #fff; font-size: 20px; cursor: pointer;">√ó</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="msg bot">Hi! I can help plan routes, budgets, nearby spots. Ask me anything.</div>
            </div>
            <form class="chat-input" id="chatForm">
                <input type="text" id="chatInput" placeholder="Type your message..." autocomplete="off" required>
                <button type="submit">Send</button>
            </form>
        </div>
        <button class="chat-toggle-btn" id="chatToggle" title="Chat with assistant">üí¨</button>
    </div>

    <script>
        /*****************************************************************************
         * Frontend-only MAP version:
         * - Uses Google Maps JS (client-side) to draw routes (DirectionsService)
         * - Samples the selected route and calls PlacesService.nearbySearch at sample points
         * - Deduplicates places by place_id and populates lists + markers
         *
         * IMPORTANT: Replace the API key in the script tag at the end with your client key
         *            restricted to your domain (for safety). Using an unrestricted key in
         *            production is unsafe.
         *****************************************************************************/

        let map, directionsService;
        let routeRenderers = [];
        let routesData = [];
        let placeMarkers = [];
        let infoWindow;
        const MAX_SAMPLES = 5;          // max number of sample points along route
        const NEARBY_RADIUS = 500;     // radius in meters to search around sample points (adjustable)
        const PLACE_LIMIT_PER_SAMPLE = 5;// limit results per sample to avoid spam

        // Initialize map (callback from script loaded at bottom)
        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 20.5937, lng: 78.9629 }, // India center
                zoom: 6,
            });
            directionsService = new google.maps.DirectionsService();
            infoWindow = new google.maps.InfoWindow();

            // show map area when script loaded
            // map content will be shown when user generates route
        }

        // Form submit
        document.getElementById('tripForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const source = document.getElementById('source').value.trim();
            const destination = document.getElementById('destination').value.trim();
            const mode = document.getElementById('mode').value;
            const generateBtn = document.getElementById('generateBtn');

            if (!source || !destination || !mode) {
                alert('Please fill in all fields.');
                return;
            }

            generateBtn.textContent = 'Generating Routes...';
            generateBtn.disabled = true;
            clearPlacesAndMarkers();
            fetchAndDisplayRoutes(source, destination, mode)
                .finally(() => { generateBtn.textContent = 'Generate Route'; generateBtn.disabled = false; });
        });

        // Fetch routes via client-side DirectionsService (draw alternatives)
        function fetchAndDisplayRoutes(origin, destination, mode) {
            // Show map
            document.getElementById('mapPlaceholder').style.display = 'none';
            document.getElementById('mapContent').classList.add('active');
            document.getElementById('map').classList.add('active');

            const modeMap = {
                driving: google.maps.TravelMode.DRIVING,
                walking: google.maps.TravelMode.WALKING,
                bicycling: google.maps.TravelMode.BICYCLING,
                transit: google.maps.TravelMode.TRANSIT
            };

            return new Promise((resolve) => {
                directionsService.route({
                    origin,
                    destination,
                    travelMode: modeMap[mode] || google.maps.TravelMode.DRIVING,
                    provideRouteAlternatives: true,
                }, (response, status) => {
                    const routesList = document.getElementById('routesList');
                    routesList.innerHTML = '';

                    if (status === "OK" && response && response.routes && response.routes.length) {
                        routesData = response.routes;
                        buildRouteRenderers(response);
                        populateRoutesList(response);
                        selectRoute(0); // default select first
                        resolve();
                    } else {
                        routesList.innerHTML = `<div class="route-placeholder">‚ùå Unable to fetch routes: ${status}</div>`;
                        resolve();
                    }
                });
            });
        }

        // Create directions renderers for each route but do not add to map yet
        function buildRouteRenderers(directionsResponse) {
            // clear old
            routeRenderers.forEach(r => r.setMap(null));
            routeRenderers = [];

            directionsResponse.routes.forEach((route, idx) => {
                const renderer = new google.maps.DirectionsRenderer({
                    map,
                    directions: directionsResponse,
                    routeIndex: idx,
                    suppressMarkers: false,
                    polylineOptions: {
                        strokeColor: ["#4285F4", "#34A853", "#FBBC05"][idx % 3],
                        strokeOpacity: 0.7,
                        strokeWeight: 5,
                    }
                });
                // hide until selected
                renderer.setMap(null);
                routeRenderers.push(renderer);
            });
        }

        // Populate the left-side route cards
        function populateRoutesList(response) {
            const routesList = document.getElementById('routesList');
            routesList.innerHTML = '';

            response.routes.forEach((route, index) => {
                const leg = route.legs[0];
                const routeItem = document.createElement('div');
                routeItem.className = 'route-item';
                routeItem.onclick = () => selectRoute(index);

                routeItem.innerHTML = `
                    <div class="route-header">
                        <div class="route-title">Route ${index + 1}</div>
                        <div class="route-badge">${["‚ö° Shortest","üåÖ Scenic","üí∞ Economical"][index % 3]}</div>
                    </div>
                    <div class="route-details">
                        <div class="route-detail">
                            <span>‚è±Ô∏è</span>
                            <span>${leg.duration.text}</span>
                        </div>
                        <div class="route-detail">
                            <span>üìè</span>
                            <span>${Math.round(leg.distance.value / 1000)} km</span>
                        </div>
                    </div>
                `;
                routesList.appendChild(routeItem);
            });
        }

        // Select a route to show on the map
        function selectRoute(index) {
            // active class
            document.querySelectorAll('.route-item').forEach((el, i) => el.classList.toggle('active', i === index));

            // show only selected renderer
            routeRenderers.forEach((r, i) => {
                if (i === index) {
                    r.setOptions({
                        polylineOptions: { strokeColor: "#38A169", strokeWeight: 6, strokeOpacity: 1 }
                    });
                    r.setMap(map);
                } else {
                    r.setMap(null);
                }
            });

            updateTripDetails(index);

            // Load nearby places along selected route
            const selectedRoute = routesData[index];
            if (selectedRoute) {
                loadNearbyPlacesAlongRoute(selectedRoute);
            }
        }

        // Update trip details panel
        function updateTripDetails(routeIndex) {
            if (!routesData || !routesData[routeIndex]) return;
            const detailsGrid = document.getElementById('detailsGrid');
            const route = routesData[routeIndex];
            const leg = route.legs[0];

            const distanceKm = Math.round(leg.distance.value / 1000);
            const mode = document.getElementById('mode').value;
            let costPerKm = 0;
            switch(mode) {
                case 'driving': costPerKm = 8; break;
                case 'transit': costPerKm = 2; break;
                default: costPerKm = 0;
            }
            const estimatedCost = Math.round(distanceKm * costPerKm);

            detailsGrid.innerHTML = `
                <div class="detail-item"><h4>Distance</h4><p>${distanceKm} km</p></div>
                <div class="detail-item"><h4>Estimated Time</h4><p>${leg.duration.text}</p></div>
                <div class="detail-item"><h4>Estimated Cost</h4><p>‚Çπ${estimatedCost}</p></div>
                <div class="detail-item"><h4>Transportation</h4><p>${mode.charAt(0).toUpperCase() + mode.slice(1)}</p></div>
            `;

            document.getElementById('tripDetails').classList.add('active');
        }

        // Clear old place markers and lists
        function clearPlacesAndMarkers() {
            // clear markers
            placeMarkers.forEach(m => m.setMap(null));
            placeMarkers = [];
            // clear lists
            document.getElementById('restaurantsList').innerHTML = '';
            document.getElementById('hospitalsList').innerHTML = '';
            document.getElementById('gasStationsList').innerHTML = '';
            // hide nearby container until we populate
            document.getElementById('nearbyPlaces').classList.remove('active');
        }

        // Sample points along route overview_path (google.maps.LatLng objects)
        function samplePolylinePoints(path, desiredCount) {
            if (!path || path.length === 0) return [];
            const count = Math.min(desiredCount, path.length);
            if (count <= 1) return [path[0]];
            const step = (path.length - 1) / (count - 1);
            const points = [];
            for (let i = 0; i < count; i++) {
                points.push(path[Math.round(i * step)]);
            }
            return points;
        }

        // Load places along the route by sampling points and calling nearbySearch
        function loadNearbyPlacesAlongRoute(route) {
            document.getElementById('nearbyPlaces').classList.add('active');

            // dedupe by place_id per category
            const seenByType = {
                restaurant: new Set(),
                hospital: new Set(),
                gas_station: new Set(),
            };

            // Create PlacesService attached to the map (client-side)
            const service = new google.maps.places.PlacesService(map);

            // path is route.overview_path (array of LatLng)
            const path = route.overview_path || [];
            const samplePoints = samplePolylinePoints(path, Math.min(MAX_SAMPLES, path.length));

            // For each sample point, query for each type
            const searchTypes = [
                { gmType: 'restaurant', listId: 'restaurantsList', key: 'restaurant' },
                { gmType: 'hospital', listId: 'hospitalsList', key: 'hospital' },
                { gmType: 'gas_station', listId: 'gasStationsList', key: 'gas_station' }
            ];

            // For UX, show loading placeholders
            searchTypes.forEach(s => {
                document.getElementById(s.listId).innerHTML = `<div class="place-item">Searching ${s.gmType} along route...</div>`;
            });

            // We'll run searches sequentially per sample point to avoid triggering quotas too fast.
            (async function runSearches() {
                // clear placeholders
                searchTypes.forEach(s => document.getElementById(s.listId).innerHTML = '');

                for (const point of samplePoints) {
                    for (const s of searchTypes) {
                        // wrap nearbySearch in a promise so we can await
                        await new Promise((resolve) => {
                            const req = {
                                location: point,
                                radius: NEARBY_RADIUS,
                                type: s.gmType
                            };
                            service.nearbySearch(req, (results, status, pagination) => {
                                if (status === google.maps.places.PlacesServiceStatus.OK && Array.isArray(results)) {
                                    const filtered = results
                                        .filter(p => p.place_id && !seenByType[s.key].has(p.place_id))
                                        .slice(0, PLACE_LIMIT_PER_SAMPLE);
                                    filtered.forEach(place => {
                                        seenByType[s.key].add(place.place_id);
                                        addPlaceToUIAndMap(place, s.listId, s.key);
                                    });
                                }
                                // small delay between calls helps avoid rate spikes
                                setTimeout(resolve, 200);
                            });
                        });
                    }
                }

                // After all samples done, if no items were found, show friendly message
                searchTypes.forEach(s => {
                    const list = document.getElementById(s.listId);
                    if (!list.innerHTML.trim()) {
                        list.innerHTML = `<div class="place-item">No ${s.gmType} found along the route within ${NEARBY_RADIUS/1000} km of sampled points.</div>`;
                    }
                });
            })();
        }

        // Add place to list and create a marker on map
        function addPlaceToUIAndMap(place, listId, categoryKey) {
            const list = document.getElementById(listId);
            const rating = place.rating ? place.rating.toFixed(4.5) : 5;
            const vicinity = place.vicinity || place.formatted_address || '';

            const placeItem = document.createElement('div');
            placeItem.className = 'place-item';

            placeItem.innerHTML = `
                <div class="place-header">
                    <div class="place-name">${place.name || 'Unknown'}</div>
                    <a href="https://www.google.com/maps/place/?q=place_id:${place.place_id}" target="_blank" rel="noopener" class="place-link">üîó</a>
                </div>
                <div class="place-details">
                    <div class="place-detail"><span class="icon rating">‚≠ê</span><span class="rating">${rating}</span></div>
                    <div class="place-detail"><span class="icon distance">üìç</span><span class="distance">${vicinity}</span></div>
                </div>
            `;

            // clicking a list item opens info window and centers map on marker (if marker exists)
            placeItem.addEventListener('click', () => {
                const marker = placeMarkers.find(m => m.placeId === place.place_id);
                if (marker) {
                    map.panTo(marker.getPosition());
                    infoWindow.setContent(`<div style="font-weight:600;">${place.name}</div><div style="font-size:13px;">${vicinity}</div>`);
                    infoWindow.open(map, marker);
                }
            });

            list.appendChild(placeItem);

            // add marker
            const marker = new google.maps.Marker({
                map,
                position: place.geometry.location,
                title: place.name,
                // small icon by category (simple colored circle)
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    fillColor: categoryKey === 'restaurant' ? '#FF7043' : (categoryKey === 'hospital' ? '#E53935' : '#FFA726'),
                    fillOpacity: 0.9,
                    scale: 6,
                    strokeColor: '#ffffff',
                    strokeWeight: 1
                }
            });
            marker.placeId = place.place_id;
            marker.addListener('click', () => {
                infoWindow.setContent(`<div style="font-weight:600;">${place.name}</div><div style="font-size:13px;">${vicinity}</div>`);
                infoWindow.open(map, marker);
            });
            placeMarkers.push(marker);
        }

        // Chat widget behavior (simple canned responses)
        const chatPanel = document.getElementById('chatPanel');
        const chatToggle = document.getElementById('chatToggle');
        const closeChat = document.getElementById('closeChat');
        const chatForm = document.getElementById('chatForm');
        const chatInput = document.getElementById('chatInput');
        const chatMessages = document.getElementById('chatMessages');

        function openChat() { chatPanel.classList.add('open'); chatInput.focus(); }
        function closeChatPanel() { chatPanel.classList.remove('open'); }

        chatToggle.addEventListener('click', () => chatPanel.classList.contains('open') ? closeChatPanel() : openChat());
        closeChat.addEventListener('click', closeChatPanel);

        chatForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const text = chatInput.value.trim();
            if (!text) return;
            appendUserMessage(text);

            // canned bot replies referencing form state
            setTimeout(() => {
                const src = document.getElementById('source').value.trim();
                const dst = document.getElementById('destination').value.trim();
                let reply = "Let me help with that ‚Äî try generating a route first.";
                if (src && dst) reply = `I see your trip: ${src} ‚Üí ${dst}. Click Generate Route to draw it and see nearby places (restaurants, hospitals, gas stations).`;
                appendBotMessage(reply);
            }, 400);

            chatInput.value = '';
        });

        function appendUserMessage(text) {
            const userMsg = document.createElement('div'); userMsg.className = 'msg user'; userMsg.textContent = text;
            chatMessages.appendChild(userMsg); chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        function appendBotMessage(text) {
            const botMsg = document.createElement('div'); botMsg.className = 'msg bot'; botMsg.textContent = text;
            chatMessages.appendChild(botMsg); chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // small UX: focus/blur effects for inputs
        const inputs = document.querySelectorAll('input, select');
        inputs.forEach(input => {
            input.addEventListener('focus', function() { this.parentElement.classList.add('focused'); });
            input.addEventListener('blur', function() { this.parentElement.classList.remove('focused'); });
        });

        // Helper: clears only route renderers (used if you want to clear route)
        function clearRouteRenderers() {
            routeRenderers.forEach(r => r.setMap(null));
            routeRenderers = [];
            routesData = [];
        }
    </script>

    <!-- Google Maps API: Replace YOUR_API_KEY_HERE with your browser-restricted client API key.
         For example:
         https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY_HERE&callback=initMap&libraries=places
         Make sure you restrict the key to your domain in Google Cloud Console.
    -->
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCeAcrbFyaVO2bxPxR2srbYyOL3fa9kmJE&callback=initMap&libraries=places">
    </script>
</body>
</html>
